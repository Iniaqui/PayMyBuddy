<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>UserFriendDAO.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">payMyBuddy</a> &gt; <a href="index.source.html" class="el_package">payMyBuddySystem.DAO</a> &gt; <span class="el_source">UserFriendDAO.java</span></div><h1>UserFriendDAO.java</h1><pre class="source lang-java linenums">package payMyBuddySystem.DAO;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import payMyBuddy.config.DataBaseConfig;
import payMyBuddySystem.constants.DBConstants;
import payMyBuddySystem.models.User;
import payMyBuddySystem.models.UserFriend;

<span class="fc" id="L15">public class UserFriendDAO implements DAO&lt;UserFriend&gt;{</span>
<span class="fc" id="L16">DataBaseConfig dataBaseConfig = new DataBaseConfig();</span>
	
	
	public boolean create(UserFriend data) {
		// TODO Auto-generated method stub
<span class="fc" id="L21">		Connection con= null;</span>
<span class="fc" id="L22">		boolean res = false;</span>
		try {
<span class="fc" id="L24">			con = dataBaseConfig.getConnection();</span>
<span class="fc" id="L25">			PreparedStatement ps = con.prepareStatement(DBConstants.SAVE_USER_FRIEND);</span>
<span class="fc" id="L26">			System.out.println(&quot;idUser &quot;+ data.getIdUser() + &quot;\n idFriend &quot;+ data.getIdFriend());</span>
<span class="fc" id="L27">			ps.setInt(1, data.getIdUser());</span>
<span class="fc" id="L28">			ps.setInt(2,data.getIdFriend());</span>
			
<span class="fc" id="L30">			int ligne  = ps.executeUpdate();</span>
<span class="pc bpc" id="L31" title="1 of 2 branches missed.">			if(ligne&gt;0) {</span>
<span class="fc" id="L32">				res = true;</span>
			}
<span class="fc" id="L34">			dataBaseConfig.closePreparedStatement(ps);</span>
			
<span class="nc" id="L36">		} catch (ClassNotFoundException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L38">			e.printStackTrace();</span>
<span class="nc" id="L39">		} catch (SQLException e) {</span>
			// TODO Auto-generated catch block
<span class="nc" id="L41">			e.printStackTrace();</span>
		}finally {
<span class="fc" id="L43">			dataBaseConfig.closeConnection(con);</span>
		}
		
<span class="fc" id="L46">		return res;</span>
	}

	
	public UserFriend read(int i) {
		// TODO Auto-generated method stub
<span class="nc" id="L52">		UserFriend userFriend = null;</span>
<span class="nc" id="L53">		Connection con = null;</span>
		try {
<span class="nc" id="L55">			con = dataBaseConfig.getConnection();</span>
<span class="nc" id="L56">			 PreparedStatement ps = con.prepareStatement(DBConstants.READ_USER_FRIEND);</span>
<span class="nc" id="L57">			ResultSet rs = ps.executeQuery();</span>
<span class="nc bnc" id="L58" title="All 2 branches missed.">			if(rs.next()) {</span>
<span class="nc" id="L59">				userFriend= new UserFriend();</span>
<span class="nc" id="L60">				userFriend.setId(i);</span>
<span class="nc" id="L61">				userFriend.setIdFriend(rs.getInt(1));</span>
<span class="nc" id="L62">				userFriend.setIdUser(rs.getInt(2));</span>
			
			}
<span class="nc" id="L65">			dataBaseConfig.closePreparedStatement(ps);</span>
			
<span class="nc" id="L67">		}catch(Exception e ) {</span>
<span class="nc" id="L68">			System.out.println(&quot;Error in the reading userFriend&quot;);</span>
		}
		finally {
<span class="nc" id="L71">			dataBaseConfig.closeConnection(con);</span>
		}
<span class="nc" id="L73">		return userFriend;</span>
	}

	
	public boolean update(UserFriend data) {
		// TODO Auto-generated method stub
<span class="nc" id="L79">		return false;</span>
	}

	
	public boolean delete(int id) {
<span class="nc" id="L84">		boolean res = false ;</span>
<span class="nc" id="L85">		Connection con = null;</span>
		try {
<span class="nc" id="L87">			con = dataBaseConfig.getConnection();</span>
			
<span class="nc" id="L89">		}catch(Exception e) {</span>
<span class="nc" id="L90">			System.out.println(&quot;DELETING ERROR &quot;);</span>
		}finally {
<span class="nc" id="L92">			dataBaseConfig.closeConnection(con);</span>
		}
		// TODO Auto-generated method stub
<span class="nc" id="L95">		return res;</span>
	}

	
	public List&lt;UserFriend&gt; getAll() {
		// TODO Auto-generated method stub
<span class="nc" id="L101">		return null;</span>
	}
	
	public User getUserFriend(String mail) {
<span class="nc" id="L105">		User u = new User();</span>
<span class="nc" id="L106">		Connection con = null;</span>
		try {
<span class="nc" id="L108">			con = dataBaseConfig.getConnection();</span>
<span class="nc" id="L109">			 PreparedStatement ps = con.prepareStatement(DBConstants.READ_USER_FRIEND_BY_MAIL);</span>
<span class="nc" id="L110">			 ps.setString(1, mail);</span>
<span class="nc" id="L111">			ResultSet rs = ps.executeQuery();</span>
<span class="nc bnc" id="L112" title="All 2 branches missed.">			if(rs.next()) {</span>
<span class="nc" id="L113">				u.setUserId(rs.getInt(1));</span>
			}
<span class="nc" id="L115">			dataBaseConfig.closePreparedStatement(ps);</span>
			
<span class="nc" id="L117">		}catch(Exception e ) {</span>
<span class="nc" id="L118">			System.out.println(&quot;Error in the reading userFriend&quot;);</span>
		}
		finally {
<span class="nc" id="L121">			dataBaseConfig.closeConnection(con);</span>
		}
<span class="nc" id="L123">		return u;</span>
	}
	public ArrayList&lt;String&gt; getAllUserFriend(int i){
<span class="nc" id="L126">		ArrayList&lt;String&gt; listeUserFriend = new ArrayList&lt;String&gt;();</span>
<span class="nc" id="L127">		Connection con = null;</span>
		try {
<span class="nc" id="L129">			con = dataBaseConfig.getConnection();</span>
<span class="nc" id="L130">			 PreparedStatement ps = con.prepareStatement(DBConstants.READ_USER_FRIEND);//SELECT idRelation ,idFriend, idUser FROM userfriend WHERE idUser = ? OR idFriend= ?</span>
<span class="nc" id="L131">			 ps.setInt(1, i);</span>
<span class="nc" id="L132">			 ps.setInt(2, i);</span>
<span class="nc" id="L133">			ResultSet rs = ps.executeQuery();</span>
<span class="nc bnc" id="L134" title="All 2 branches missed.">			while(rs.next()) {</span>
<span class="nc" id="L135">				int idFriend = rs.getInt(2);</span>
<span class="nc" id="L136">				PreparedStatement psUser = con.prepareStatement(DBConstants.READ_USER_BY_ID);//SELECT idUser,mail,balance,step FROM users WHERE idUser = ? </span>
<span class="nc" id="L137">				psUser.setInt(1, idFriend);</span>
<span class="nc" id="L138">				ResultSet resUser = psUser.executeQuery();</span>
<span class="nc bnc" id="L139" title="All 2 branches missed.">				if(resUser.next()) {</span>
<span class="nc" id="L140">					String mailFriend = resUser.getString(2);</span>
<span class="nc" id="L141">					listeUserFriend.add(mailFriend);</span>
				}
<span class="nc" id="L143">			}</span>
<span class="nc" id="L144">			dataBaseConfig.closePreparedStatement(ps);</span>
			
<span class="nc" id="L146">		}catch(Exception e ) {</span>
<span class="nc" id="L147">			System.out.println(&quot;Error in the reading userFriend&quot;);</span>
		}
		finally {
<span class="nc" id="L150">			dataBaseConfig.closeConnection(con);</span>
		}
<span class="nc" id="L152">		return listeUserFriend;</span>
	}

	public boolean deletUserFriend(int idUser , int idFriend) {
<span class="nc" id="L156">		boolean isDelete = false ;</span>
		
<span class="nc" id="L158">		Connection con = null;</span>
		try {
<span class="nc" id="L160">			con = dataBaseConfig.getConnection();</span>
<span class="nc" id="L161">			 PreparedStatement ps = con.prepareStatement(DBConstants.DELETE_USER_FRIEND);</span>
<span class="nc" id="L162">			 ps.setInt(1, idUser);</span>
<span class="nc" id="L163">			 ps.setInt(2, idUser);</span>
<span class="nc" id="L164">			 ps.setInt(3, idFriend);</span>
<span class="nc" id="L165">			 ps.setInt(4, idFriend);</span>
<span class="nc" id="L166">			int ligne = ps.executeUpdate();</span>
<span class="nc bnc" id="L167" title="All 2 branches missed.">			if(ligne&gt;0) {</span>
<span class="nc" id="L168">				System.out.println(&quot;Suppression de la relation reussi &quot;);</span>
<span class="nc" id="L169">				isDelete= true ; </span>
			}
			else {
<span class="nc" id="L172">				System.out.println(&quot;Probelem avec la suppression &quot;);</span>
			}
<span class="nc" id="L174">		}catch(Exception e) {</span>
<span class="nc" id="L175">			System.out.println(&quot;DELETING ERROR &quot;);</span>
		}finally {
<span class="nc" id="L177">			dataBaseConfig.closeConnection(con);</span>
		}
		// TODO Auto-generated method stub
<span class="nc" id="L180">		return isDelete;</span>
	}
	
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>